<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to RtoSQLServer • RtoSQLServer</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to RtoSQLServer">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">RtoSQLServer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.2.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/RtoSQLServer.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/RtoSQLServer.html">Get started</a></li>
    <li><a class="dropdown-item" href="../articles/read_filter.html">Read table with column or row filtering</a></li>
    <li><a class="dropdown-item" href="../articles/load_method.html">Table loading method description</a></li>
    <li><a class="dropdown-item" href="../articles/why_use.html">Why use this package?</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ScotGovAnalysis/RtoSQLServer/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to RtoSQLServer</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ScotGovAnalysis/RtoSQLServer/blob/main/vignettes/RtoSQLServer.Rmd" class="external-link"><code>vignettes/RtoSQLServer.Rmd</code></a></small>
      <div class="d-none name"><code>RtoSQLServer.Rmd</code></div>
    </div>

    
    
<p>RtoSQLServer is used to load R data frames into MS SQL Server and to
modify existing MS SQL Server tables using R. This page outlines some of
the main functions.</p>
<div class="section level2">
<h2 id="preliminary-setup">Preliminary setup<a class="anchor" aria-label="anchor" href="#preliminary-setup"></a>
</h2>
<p>A test data frame is created for these examples.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ScotGovAnalysis.github.io/RtoSQLServer" class="external-link">RtoSQLServer</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make a test dataframe with n rows</span></span>
<span><span class="va">test_n_rows</span> <span class="op">&lt;-</span> <span class="fl">123456</span></span>
<span><span class="va">test_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  colour_cat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"amber"</span>, <span class="st">"green"</span><span class="op">)</span>, <span class="va">test_n_rows</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">test_n_rows</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>RtoSQLServer functions create a connection to the database and
disconnect it at the end of that function’s process. Each function
requires server, database arguments and often a schema argument too.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set database connection details for use in functions:</span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="st">"server\\instance"</span></span>
<span><span class="va">database</span> <span class="op">&lt;-</span> <span class="st">"my_database_name"</span></span>
<span><span class="va">schema</span> <span class="op">&lt;-</span> <span class="st">"my_schema_name"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="write-a-data-frame-to-database">Write a data frame to database<a class="anchor" aria-label="anchor" href="#write-a-data-frame-to-database"></a>
</h2>
<p>We can load the <code>test_df</code> data frame into the MS SQL
Server database using the <code><a href="../reference/write_dataframe_to_db.html">write_dataframe_to_db()</a></code> function.
Here we have set a 10K batch size so the source R data frame is loaded
into the staging table in batches of this size. In this example, we do
not include arguments <code>append_to_existing</code> or
<code>versioned_table</code> as we want to use the default of
<code>FALSE</code> for each.</p>
<p>See <a href="load_method.html">Table loading method</a> for a
detailed description of how a data frame is loaded into a table using
RtoSQLServer.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load data frame into MS SQL Server database</span></span>
<span><span class="fu"><a href="../reference/write_dataframe_to_db.html">write_dataframe_to_db</a></span><span class="op">(</span></span>
<span>  server <span class="op">=</span> <span class="va">server</span>,</span>
<span>  database <span class="op">=</span> <span class="va">database</span>,</span>
<span>  schema <span class="op">=</span> <span class="va">schema</span>,</span>
<span>  table_name <span class="op">=</span> <span class="st">"test_r_tbl"</span>,</span>
<span>  dataframe <span class="op">=</span> <span class="va">test_df</span>,</span>
<span>  batch_size <span class="op">=</span> <span class="fl">1e4</span>,</span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="get-table-metadata">Get table metadata<a class="anchor" aria-label="anchor" href="#get-table-metadata"></a>
</h2>
<p>Once the table is loaded we can check its columns, its column data
types and get some summary info using
<code><a href="../reference/db_table_metadata.html">db_table_metadata()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get table metadata including summary stats (getting the extra stats is</span></span>
<span><span class="co"># slower for large tables)</span></span>
<span><span class="fu"><a href="../reference/db_table_metadata.html">db_table_metadata</a></span><span class="op">(</span></span>
<span>  server <span class="op">=</span> <span class="va">server</span>,</span>
<span>  database <span class="op">=</span> <span class="va">database</span>,</span>
<span>  schema <span class="op">=</span> <span class="va">schema</span>,</span>
<span>  table_name <span class="op">=</span> <span class="st">"test_r_tbl"</span>,</span>
<span>  summary_stats <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="read-database-table-into-r">Read database table into R<a class="anchor" aria-label="anchor" href="#read-database-table-into-r"></a>
</h2>
<p>We can read a database table back into an R data frame using
<code><a href="../reference/read_table_from_db.html">read_table_from_db()</a></code>.</p>
<p>It is possible to read a subset of table columns by using a character
vector of column names in the <code>columns</code> argument. A filter
can also be specified for <code>filter_stmt</code> to read a subset of
rows. The filter should be written in R, not SQL syntax. See the <a href="read_filter.html">column and row filtering article</a> for more
information.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read all rows and columns from test_r_tbl into data frame</span></span>
<span><span class="va">db_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_table_from_db.html">read_table_from_db</a></span><span class="op">(</span></span>
<span>  server <span class="op">=</span> <span class="va">server</span>,</span>
<span>  database <span class="op">=</span> <span class="va">database</span>,</span>
<span>  schema <span class="op">=</span> <span class="va">schema</span>,</span>
<span>  table_name <span class="op">=</span> <span class="st">"test_r_tbl"</span>,</span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="append-rows-to-existing-table">Append rows to existing table<a class="anchor" aria-label="anchor" href="#append-rows-to-existing-table"></a>
</h2>
<p>Eventually we might have more rows to load into the database table.
We can do this using <code><a href="../reference/write_dataframe_to_db.html">write_dataframe_to_db()</a></code> specifying
<code>append_to_existing = TRUE</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make another test dataframe to load with append option</span></span>
<span><span class="co"># An extra column is added to this data frame to demo functionality</span></span>
<span><span class="va">test_n_rows</span> <span class="op">&lt;-</span> <span class="fl">1234</span></span>
<span><span class="va">test_df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  colour_cat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"purple"</span>, <span class="st">"pink"</span><span class="op">)</span>, <span class="va">test_n_rows</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">test_n_rows</span><span class="op">)</span>,</span>
<span>  extra_col <span class="op">=</span> <span class="st">"a"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In this case the <code>test_df2</code> data frame has an extra
column. When this is loaded with the
<code>append_to_existing = TRUE</code> option the extra column will be
added to the existing table using <code><a href="../reference/add_column.html">add_column()</a></code> and
populated with the source data frame values. Of course, the existing
records in the database table will be NULL for this new column.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/write_dataframe_to_db.html">write_dataframe_to_db</a></span><span class="op">(</span></span>
<span>  server <span class="op">=</span> <span class="va">server</span>,</span>
<span>  database <span class="op">=</span> <span class="va">database</span>,</span>
<span>  schema <span class="op">=</span> <span class="va">schema</span>,</span>
<span>  table_name <span class="op">=</span> <span class="st">"test_r_tbl"</span>,</span>
<span>  dataframe <span class="op">=</span> <span class="va">test_df2</span>,</span>
<span>  batch_size <span class="op">=</span> <span class="fl">1e3</span>,</span>
<span>  append_to_existing <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="drop-table-column">Drop table column<a class="anchor" aria-label="anchor" href="#drop-table-column"></a>
</h2>
<p>If we decide we do not want the newly added column we can use
<code><a href="../reference/drop_column.html">drop_column()</a></code> to delete it from the database table.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/drop_column.html">drop_column</a></span><span class="op">(</span></span>
<span>  server <span class="op">=</span> <span class="va">server</span>,</span>
<span>  database <span class="op">=</span> <span class="va">database</span>,</span>
<span>  schema <span class="op">=</span> <span class="va">schema</span>,</span>
<span>  table_name <span class="op">=</span> <span class="st">"test_r_tbl"</span>,</span>
<span>  column_name <span class="op">=</span> <span class="st">"extra_col"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="delete-table-rows">Delete table rows<a class="anchor" aria-label="anchor" href="#delete-table-rows"></a>
</h2>
<p>We can also delete a subset of rows from our database table using
<code><a href="../reference/delete_table_rows.html">delete_table_rows()</a></code> and specifying a filter for the
<code>filter_stmt</code> argument. The syntax for the filter is the same
R format as for <code><a href="../reference/read_table_from_db.html">read_table_from_db()</a></code>.</p>
<p>Be careful when deleting rows that your filter is correct and not
going to delete more rows than you wish. Testing it as a
<code>filter_stmt</code> argument to <code><a href="../reference/read_table_from_db.html">read_table_from_db()</a></code>
first can be a good idea.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/delete_table_rows.html">delete_table_rows</a></span><span class="op">(</span></span>
<span>  server <span class="op">=</span> <span class="va">server</span>,</span>
<span>  database <span class="op">=</span> <span class="va">database</span>,</span>
<span>  schema <span class="op">=</span> <span class="va">schema</span>,</span>
<span>  table_name <span class="op">=</span> <span class="st">"test_r_tbl"</span>,</span>
<span>  filter_stmt <span class="op">=</span> <span class="st">"colour_cat == 'blue' &amp; val &gt; 0.5"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="drop-a-table">Drop a table<a class="anchor" aria-label="anchor" href="#drop-a-table"></a>
</h2>
<p>To delete the table completely from the database schema, use
<code><a href="../reference/drop_table_from_db.html">drop_table_from_db()</a></code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/drop_table_from_db.html">drop_table_from_db</a></span><span class="op">(</span></span>
<span>  server <span class="op">=</span> <span class="va">server</span>,</span>
<span>  database <span class="op">=</span> <span class="va">database</span>,</span>
<span>  schema <span class="op">=</span> <span class="va">schema</span>,</span>
<span>  table_name <span class="op">=</span> <span class="st">"test_r_tbl"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="show-tables-and-views-in-a-schema">Show tables (and views) in a schema<a class="anchor" aria-label="anchor" href="#show-tables-and-views-in-a-schema"></a>
</h2>
<p>If want to see what tables (and views) remain in the schema use
<code><a href="../reference/show_schema_tables.html">show_schema_tables()</a></code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/show_schema_tables.html">show_schema_tables</a></span><span class="op">(</span></span>
<span>  server <span class="op">=</span> <span class="va">server</span>,</span>
<span>  database <span class="op">=</span> <span class="va">database</span>,</span>
<span>  schema <span class="op">=</span> <span class="va">schema</span>,</span>
<span>  include_views <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="views">Views<a class="anchor" aria-label="anchor" href="#views"></a>
</h2>
<p>Views are stored queries in the database that appear as tables and
can be read with <code><a href="../reference/read_table_from_db.html">read_table_from_db()</a></code>. They can be useful
if you regularly need to join the same tables together or apply the same
column selections or row filters on the data you wish to read into R.
You can write a <code>CREATE VIEW</code> SQL statement and use
<code><a href="../reference/execute_sql.html">execute_sql()</a></code> in R to run the SQL to create a view. A
create view function might be added to RtoSQLServer in future.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by the Scottish Government  <a href="mailto:statistics.enquiries@gov.scot"><i class="fas fa-envelope" aria-hidden="true"></i><span class="visually-hidden">Email Scottish Government&gt;</span></a>  <a href="https://github.com/scotgovanalysis" class="external-link"><i class="fab fa-github" aria-hidden="true"></i><span class="visually-hidden">Scottish Government GitHub profile&gt;</span></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
